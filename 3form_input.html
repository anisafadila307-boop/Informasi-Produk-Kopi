<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Input Informasi Produk Kopi Lengkap</title>
  <style>
:root{
  --brown1:#3e2723;
  --brown2:#5d4037;
  --brown3:#8d6e63;
  --light:#f6f3f0;
  --card:#fffaf7;
}
body{
  margin:0;
  font-family:"Poppins",sans-serif;
  background:var(--light);
  color:var(--brown1);
}
.container{
  max-width:960px;
  margin:auto;
  padding:30px 20px 60px;
}
h1{text-align:center;margin-bottom:10px;}
p.subtitle{text-align:center;color:var(--brown2);}
form{
  background:var(--card);
  border-radius:16px;
  box-shadow:0 6px 20px rgba(0,0,0,0.08);
  padding:24px;
  display:grid;
  gap:12px;
  margin-top:24px;
}
label{font-weight:600;font-size:14px;}
input,select,textarea{
  width:100%;padding:10px 12px;
  border:1px solid #ddd;border-radius:8px;
  font-family:inherit;font-size:14px;
}
textarea{min-height:70px;}
input[type=file]{border:none;}
button{
  background:var(--brown2);color:#fff;
  border:none;border-radius:8px;
  padding:10px 14px;font-weight:600;
  cursor:pointer;transition:0.2s;
}
button:hover{background:var(--brown3);}
.preview{max-width:100%;max-height:180px;display:block;margin-top:6px;border-radius:8px;}
.jenis-btns {
  display:flex;justify-content:center;gap:10px;margin-top:8px;
}
.jenis-btns button {
  flex:1;background:var(--brown2);color:#fff;border:none;border-radius:8px;
  padding:10px 12px;cursor:pointer;transition:background 0.3s,transform 0.2s;
}
.jenis-btns button:hover{background:var(--brown3);transform:translateY(-2px);}
.jenis-btns button.active {
  background: var(--brown3);
  transform: scale(1.05);
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
}
.back-dashboard{
  display:block;text-align:center;margin:20px auto 0;
  background:var(--brown2);color:white;text-decoration:none;
  border-radius:8px;padding:10px 16px;font-weight:600;
}
  </style>
</head>
<body>
<div class="container">
  <h1>Form Input Produk Kopi Lengkap</h1>
  <p class="subtitle">Pilih jenis kopi dan isi data lengkap di bawah</p>

  <div class="jenis-btns">
    <button type="button" onclick="setJenis('Biji Kopi Mentah')">Biji Kopi Mentah</button>
    <button type="button" onclick="setJenis('Biji Kopi Roasted')">Biji Kopi Roasted</button>
    <button type="button" onclick="setJenis('Kopi Bubuk')">Kopi Bubuk</button>
  </div>

  <form id="produkForm">
    <input type="hidden" id="jenis" />
    <div><label>Nama Produk</label><input id="nama" required placeholder="Contoh: Arabika Gayo Premium"></div>
    <div><label>Grade</label><input id="grade" placeholder="Contoh: Grade 1 / Specialty"></div>
    <div><label>Asal Daerah</label><input id="asal" placeholder="Contoh: Aceh Tengah"></div>
    <div><label>Harga (Rp./1000gr)</label><input id="harga" type="number" placeholder="Contoh: 75000"></div>

    <div id="kadarAir" style="display:none;"><label>Kadar Air (Moisture)</label><input id="moisture" type="number" step="0.1" placeholder="Contoh: 12.5"></div>
    <div id="defectValue" style="display:none;"><label>Defect Value</label><input id="defect" type="number" step="0.1" placeholder="Contoh: 5.2"></div>
    <div id="ukuranBiji" style="display:none;"><label>Ukuran Biji (Screen Size)</label><input id="ukuran" placeholder="Contoh: 17/18"></div>

    <div><label>Karakteristik Aroma</label><input id="aroma" placeholder="Contoh: floral, nutty, chocolate"></div>
    <div><label>Karakteristik Rasa</label><input id="rasa" placeholder="Contoh: sweet, fruity, bitter"></div>
    <div><label>Tingkat Keasaman</label>
      <select id="keasaman">
        <option value="">Pilih</option><option>Rendah</option><option>Sedang</option><option>Tinggi</option>
      </select></div>
    <div><label>Body (Kekentalan)</label>
      <select id="body">
        <option value="">Pilih</option><option>Ringan</option><option>Sedang</option><option>Penuh</option>
      </select></div>
    <div><label>Deskripsi</label><textarea id="deskripsi" placeholder="Tuliskan deskripsi umum produk kopi"></textarea></div>
    <div><label>Gambar Profil</label><input type="file" id="gambarProfil" accept="image/*"><img id="previewProfil" class="preview" style="display:none;"></div>
    <button type="submit">Simpan Produk</button>
  </form>

  <a href="2dashboard_internal.html" class="back-dashboard">‚Üê Kembali ke Dashboard</a>
</div>

<script>
function setJenis(j){
  document.getElementById('jenis').value = j;

  // ubah tampilan tombol aktif
  document.querySelectorAll('.jenis-btns button').forEach(btn => {
    if (btn.textContent === j) {
      btn.classList.add('active');
    } else {
      btn.classList.remove('active');
    }
  });

  // tampilkan field khusus untuk biji kopi mentah
  const isMentah = j === 'Biji Kopi Mentah';
  document.getElementById('kadarAir').style.display = isMentah ? 'block' : 'none';
  document.getElementById('defectValue').style.display = isMentah ? 'block' : 'none';
  document.getElementById('ukuranBiji').style.display = isMentah ? 'block' : 'none';
}


// preview gambar
function previewImage(input,targetId){
  const file=input.files[0];const img=document.getElementById(targetId);
  if(!file){img.style.display='none';return;}
  const reader=new FileReader();
  reader.onload=e=>{
    img.src=e.target.result;
    img.style.display='block';
  };
  reader.readAsDataURL(file);
}
document.getElementById('gambarProfil').addEventListener('change',e=>previewImage(e.target,'previewProfil'));
</script>

<!-- Firebase Simpan Data -->
<script type="module">
  import { db } from "./firebase-init.js";
  import { ref, set, update, get, child, push } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

  const form = document.getElementById("produkForm");
  const jenisInput = document.getElementById("jenis");
  const preview = document.getElementById("previewProfil");
  const produkId = sessionStorage.getItem("produkEditId"); // ID produk yang mau diedit

  // --- Mode Edit: Ambil data dari Firebase dan tampilkan di form ---
  if (produkId) {
    const dbRef = ref(db);
    get(child(dbRef, "produk/" + produkId)).then((snapshot) => {
      if (snapshot.exists()) {
        const data = snapshot.val();
        // Isi form dengan data yang sudah ada
        for (const key in data) {
          if (document.getElementById(key)) {
            document.getElementById(key).value = data[key];
          }
        }
        if (data.jenis) setJenis(data.jenis);
        if (data.gambarProfil) {
          preview.src = data.gambarProfil;
          preview.style.display = "block";
        }
      } else {
        console.log("Data produk tidak ditemukan.");
      }
    }).catch((error) => {
      console.error("Gagal memuat data:", error);
    });
  }

  // --- Simpan Perubahan atau Tambah Baru ---
  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    const jenis = jenisInput.value;
    if (!jenis) {
      alert("Pilih jenis kopi terlebih dahulu!");
      return;
    }

    const dataProduk = {
      nama: document.getElementById("nama").value.trim(),
      jenis,
      grade: document.getElementById("grade").value.trim(),
      asal: document.getElementById("asal").value.trim(),
      harga: document.getElementById("harga").value.trim(),
      moisture: document.getElementById("moisture").value.trim(),
      defect: document.getElementById("defect").value.trim(),
      ukuran: document.getElementById("ukuran").value.trim(),
      deskripsi: document.getElementById("deskripsi").value.trim(),
      aroma: document.getElementById("aroma").value.trim(),
      rasa: document.getElementById("rasa").value.trim(),
      keasaman: document.getElementById("keasaman").value,
      body: document.getElementById("body").value,
      gambarProfil: preview.src || "",
      tanggal: Date.now()
    };

    try {
      if (produkId) {
        // Mode edit: update produk yang sudah ada
        await update(ref(db, "produk/" + produkId), dataProduk);
        alert("Produk berhasil diperbarui di Firebase!");
        sessionStorage.removeItem("produkEditId");
      } else {
        // Mode tambah baru
        const newRef = push(ref(db, "produk/"));
        await set(newRef, dataProduk);
        alert("Produk baru berhasil disimpan ke Firebase!");
      }
      form.reset();
      preview.style.display = "none";
      window.location.href = "2dashboard_internal.html"; // kembali ke dashboard
    } catch (err) {
      console.error(err);
      alert("Terjadi kesalahan saat menyimpan data.");
    }
  });
</script>
</body>
</html>


